/**!
 * Copyright © 2017-2025 Dragan Đurić. All rights reserved.
 *
 * @package warp-imagick
 * @license GNU General Public License Version 2.
 * @copyright © 2017-2025. All rights reserved.
 * @author Dragan Đurić
 * @link https://warp-imagick.pagespeed.club/
 *
 * This copyright notice, source files, licenses and other included
 * materials are protected by U.S. and international copyright laws.
 * You are not allowed to remove or modify this or any other
 * copyright notice contained within this software package.
 */

(function ($) {
	if (typeof $ === 'function') {
		function abstractSettingsSaveState ( page_slug ) {
			var sections       = document.getElementsByClassName( 'section-accordion-toggle' );
			var sections_len   = sections.length;
			var section_state  = '';
			var sections_state = '';
			for (var i = 0; i < sections_len; i++) {
				section_state = sections[i].checked ? '1' : '0';
				sections_state += section_state;
			}

			var tab_state = 0;
			var tabs      = document.getElementsByClassName( 'nav-tab-state' );
			var tabs_len  = tabs.length;
			for (var i = 0; i < tabs_len; i++) {
				if (tabs[i].checked) {
					tab_state = i;
					break;
				}
			}
			wpCookies.setHash(
				page_slug,
				{
					tabindex: tab_state,
					sections: sections_state,
				}
			);
		}
		function fixMozillaSlider () { // Mozilla/FF: fix slider thumb position on html-reload.
			$( 'input[type=range]' ).each(
				function (ix, el) {
					el.value = el.defaultValue;
				}
			);
		}
		$( /* On Document Load */
			function () {
				page_slug = document.getElementById( 'settings-page' ).dataset.page; /* Generated by settings-page. */
				if (typeof page_slug === 'string' && page_slug) {
					if ( typeof wpCookies === 'object' ) { /* wpCookies from wp-includes/js/utils.js */
						window.onbeforeunload = function () {
							abstractSettingsSaveState( page_slug );
						}
					} else {
						console.log( 'Object "wpCookies" not found. Check if wp-includes/js/utils.js is loaded' );
					}
					if (typeof adminpage === 'string' && adminpage) {
						try {
							window.postboxes.add_postbox_toggles( adminpage ); // Initialize Meta Boxes.
						} catch (err) {
							console.log( 'Exception caught on "window.postboxes.add_postbox_toggles()".' );
							console.log( err.name );
							console.log( err.message );
						}
					} else {
						console.log( 'Var "adminpage" not found.' );
					}
					fixMozillaSlider();
				} else {
					console.log( 'Element #settings-page[data-page] not found.' );
				}
			}
		);
	} else {
		console.log( 'jQuery function not available (' + typeof $ + ')' );
	}
}(jQuery));
